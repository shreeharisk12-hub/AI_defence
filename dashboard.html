<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military Command Dashboard</title>
    <meta name="description"
        content="Futuristic desert military command dashboard with real-time telemetry, detection protocols, and intel image upload.">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="bg-image"></div>
    <div class="bg-grid"></div>

    <!-- LEFT COLUMN -->
    <div class="column left-col">
        <div class="panel panel-1">
            <div class="heading">Confidence Scores</div>
            <p style="margin-bottom: 16px;">YOLO MODEL DETECTION CONFIDENCE — REAL-TIME THREAT PROBABILITY ANALYSIS</p>
            <div class="confidence-section">
                <div class="confidence-item">
                    <div class="confidence-label">
                        <span>TANK</span>
                        <span class="confidence-value" id="conf-tank">0%</span>
                    </div>
                    <div class="confidence-track">
                        <div class="confidence-fill" id="fill-tank" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="confidence-item">
                    <div class="confidence-label">
                        <span>FIGHTER JET</span>
                        <span class="confidence-value" id="conf-jet">0%</span>
                    </div>
                    <div class="confidence-track">
                        <div class="confidence-fill" id="fill-jet" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="confidence-item">
                    <div class="confidence-label">
                        <span>APC</span>
                        <span class="confidence-value" id="conf-apc">0%</span>
                    </div>
                    <div class="confidence-track">
                        <div class="confidence-fill" id="fill-apc" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-2">
            <div class="heading">Rolling Threat Feed</div>
            <div class="threat-feed" id="threatFeed">
                <div class="threat-entry">[07:00:12] SYSTEM BOOT — THREAT MONITORING INITIALIZED</div>
                <div class="threat-entry">[07:02:45] RADAR SWEEP COMPLETE — NO CONTACTS IN SECTOR 1</div>
                <div class="threat-entry">[07:05:33] SAT-COM LINK ESTABLISHED — AWAITING INTEL UPLOAD</div>
                <div class="threat-entry warning">[07:08:19] CAUTION: UNIDENTIFIED MOVEMENT IN SECTOR 4/B</div>
            </div>
        </div>
    </div>

    <!-- CENTER COLUMN -->
    <div class="column center-col">
        <div class="panel panel-1">
            <div class="map-placeholder" id="satcomContainer">
                <div class="heading map-top-left">SAT-COM LINK</div>
                <div class="map-crosshair" id="satcomCrosshair"></div>
                <!-- Topographic contours -->
                <svg width="100%" height="100%" id="satcomContours"
                    style="position:absolute; opacity:0.15; stroke: var(--text-heading); fill:none; z-index: 1;">
                    <path d="M-50 50 Q 150 150 350 80 T 600 120 T 900 90" stroke-width="1" />
                    <path d="M-50 100 Q 180 200 350 120 T 600 160 T 900 140" stroke-width="1" />
                    <path d="M-50 150 Q 200 250 400 180 T 700 200" stroke-width="1" />
                </svg>
                <!-- Uploaded image preview -->
                <img class="satcom-image" id="satcomImage" alt="Satellite intel preview">
                <!-- Scanning overlay -->
                <div class="scanning-overlay" id="scanningOverlay">
                    <div class="scan-line"></div>
                    <span class="scan-text" id="scanText">SCANNING...</span>
                </div>
            </div>
        </div>
        <div class="panel panel-2" id="centerVisualPanel">
            <div class="tank-wireframe" id="tankWireframe">
                <svg class="tank-svg" viewBox="0 0 200 200">
                    <!-- Treads -->
                    <rect x="30" y="20" width="30" height="160" rx="3" fill="rgba(0, 168, 154, 0.08)"
                        stroke="currentColor" />
                    <rect x="140" y="20" width="30" height="160" rx="3" fill="rgba(0, 168, 154, 0.08)"
                        stroke="currentColor" />
                    <line x1="30" y1="40" x2="60" y2="40" stroke="currentColor" />
                    <line x1="30" y1="60" x2="60" y2="60" stroke="currentColor" />
                    <line x1="30" y1="80" x2="60" y2="80" stroke="currentColor" />
                    <line x1="30" y1="100" x2="60" y2="100" stroke="currentColor" />
                    <line x1="30" y1="120" x2="60" y2="120" stroke="currentColor" />
                    <line x1="30" y1="140" x2="60" y2="140" stroke="currentColor" />
                    <line x1="30" y1="160" x2="60" y2="160" stroke="currentColor" />

                    <line x1="140" y1="40" x2="170" y2="40" stroke="currentColor" />
                    <line x1="140" y1="60" x2="170" y2="60" stroke="currentColor" />
                    <line x1="140" y1="80" x2="170" y2="80" stroke="currentColor" />
                    <line x1="140" y1="100" x2="170" y2="100" stroke="currentColor" />
                    <line x1="140" y1="120" x2="170" y2="120" stroke="currentColor" />
                    <line x1="140" y1="140" x2="170" y2="140" stroke="currentColor" />
                    <line x1="140" y1="160" x2="170" y2="160" stroke="currentColor" />

                    <!-- Main Body -->
                    <path d="M50 40 L150 40 L160 100 L150 160 L50 160 L40 100 Z" fill="rgba(27, 20, 15, 0.9)"
                        stroke="currentColor" stroke-width="2" />
                    <!-- Turret Base -->
                    <circle cx="100" cy="110" r="40" fill="rgba(27, 20, 15, 0.9)" stroke="currentColor" />
                    <!-- Detail lines on turret -->
                    <path d="M70 110 L130 110 M100 80 L100 140" stroke-dasharray="4 4" stroke="var(--border-color)" />

                    <!-- Barrel housing -->
                    <rect x="88" y="70" width="24" height="40" fill="rgba(0, 168, 154, 0.08)" stroke="currentColor" />
                    <!-- Barrel -->
                    <rect x="94" y="10" width="12" height="60" fill="rgba(0, 168, 154, 0.12)" stroke="currentColor" />
                    <rect x="92" y="5" width="16" height="15" fill="none" stroke="currentColor" stroke-width="2" />

                    <!-- Target Overlay -->
                    <circle cx="100" cy="100" r="90" stroke="rgba(255, 59, 47, 0.4)" stroke-width="1.5"
                        stroke-dasharray="15 10" />
                    <path d="M100 0 L100 200 M0 100 L200 100" stroke="rgba(255, 59, 47, 0.3)" stroke-width="1.5" />
                </svg>
                <div class="heading tank-title">TANK</div>
                <div class="status-text red-text">LOCATED</div>
            </div>
            <!-- YOLO result image — hidden until backend provides processed image -->
            <img class="yolo-result-image" id="yoloResultImage" alt="YOLO detection result">
        </div>
        <div class="panel panel-3">
            <div class="heading" style="font-size: 15px; margin-bottom: 12px;">AI ANALYSIS OUTPUT</div>
            <div class="system-log" id="ai-results-status">
                &gt; NO AI RESULTS AVAILABLE<br>
                &gt; AWAITING MODEL RESPONSE...<br>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="column right-col">
        <div class="panel panel-1">
            <div class="heading">CLOUD INTEL SYNC</div>
            <svg class="cloud-svg" viewBox="0 0 24 24" style="align-self: center; margin-top: 10px;">
                <path
                    d="M17.5 19C19.9853 19 22 16.9853 22 14.5C22 12.1384 20.1843 10.2018 17.8778 10.0163C17.4475 7.1724 15.0116 5 12 5C9.28929 5 6.94639 6.84852 6.20811 9.32437C3.84078 9.5447 2 11.5317 2 14C2 16.5 4 18.5 6.5 18.5"
                    stroke="var(--text-heading)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 11V15M12 15L10 13M12 15L14 13" stroke="var(--text-heading)" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <ul class="data-list" style="margin-top: auto; margin-bottom: 10px;">
                <li><span>CLOUD SYNC</span><span class="text-muted">PENDING</span></li>
                <li><span>TARGET</span><span>AWS S3</span></li>
                <li><span>STATUS</span><span class="red-text" style="font-weight: bold;">NOT CONNECTED</span></li>
            </ul>
            <!-- Future Integration: AWS S3 Upload -->
        </div>
        <div class="panel panel-2" onclick="window.location.href='ai-results.html'">
            <div class="heading">Operational Brief</div>
            <p>
                COMMAND DIRECTIVE 09-ALPHA HAS BEEN ISSUED. ALL UNITS ARE TO MAINTAIN STRICT RADIO SILENCE UNTIL
                PLATFORM ENGAGEMENT CONFIRMATION IS ACHIEVED.<br><br>
                TERRAIN ANALYSIS INDICATES MODERATE TO HIGH PROBABILITY OF HOSTILE AMBUSH CAPABILITIES IN SECTOR 4/B.
                ADVANCE WITH EXTREME CAUTION. ENGAGE ONLY UPON POSITIVE IDENTIFICATION OF PRIMARY OBJECTIVE.<br><br>
                LOGISTICAL SUPPORT REMAINS ON STANDBY AT WAYPOINT DELTA. REQUEST RE-SUPPLY POST-CONTACT OR AS AMMUNITION
                STOCKS DEPLETE BELOW THRESHOLD MINIMUMS.
            </p>
        </div>
        <div class="panel panel-3" id="upload-panel">
            <div class="heading" style="font-size: 14px; margin-bottom: 15px;">Intel Image Upload</div>
            <div class="upload-panel">
                <div class="upload-area" id="dropZone">
                    <div class="upload-placeholder" id="uploadPlaceholder">
                        <svg class="upload-icon" viewBox="0 0 24 24" stroke-width="1.5">
                            <path d="M12 16V4M12 4L8 8M12 4L16 8" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M4 14V18C4 19.1 4.9 20 6 20H18C19.1 20 20 19.1 20 18V14" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <div class="upload-text">
                            DRAG &amp; DROP IMAGE<br>
                            OR <span id="browseBtn">BROWSE FILES</span>
                        </div>
                    </div>
                    <img class="upload-preview" id="previewImg" alt="Intel preview">
                    <input type="file" class="upload-input" id="fileInput" accept="image/*">
                </div>
                <div class="upload-status" id="uploadStatus"></div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            // === DOM REFERENCES ===
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const browseBtn = document.getElementById('browseBtn');
            const previewImg = document.getElementById('previewImg');
            const placeholder = document.getElementById('uploadPlaceholder');
            const statusEl = document.getElementById('uploadStatus');

            // SAT-COM elements
            const satcomImage = document.getElementById('satcomImage');
            const satcomCrosshair = document.getElementById('satcomCrosshair');
            const satcomContours = document.getElementById('satcomContours');
            const scanningOverlay = document.getElementById('scanningOverlay');
            const scanText = document.getElementById('scanText');

            // Confidence bar elements
            const confElements = {
                tank: { fill: document.getElementById('fill-tank'), value: document.getElementById('conf-tank') },
                jet: { fill: document.getElementById('fill-jet'), value: document.getElementById('conf-jet') },
                apc: { fill: document.getElementById('fill-apc'), value: document.getElementById('conf-apc') }
            };

            // Threat feed
            const threatFeed = document.getElementById('threatFeed');

            // YOLO result
            const yoloResultImage = document.getElementById('yoloResultImage');
            const tankWireframe = document.getElementById('tankWireframe');

            // === UPLOAD EVENT HANDLERS ===
            browseBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                fileInput.click();
            });

            dropZone.addEventListener('click', function () {
                fileInput.click();
            });

            dropZone.addEventListener('dragover', function (e) {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', function () {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', function (e) {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            fileInput.addEventListener('change', function () {
                if (fileInput.files.length > 0) {
                    handleFile(fileInput.files[0]);
                }
            });

            // === CORE FILE HANDLER ===
            function handleFile(file) {
                if (!file.type.startsWith('image/')) {
                    statusEl.textContent = 'ERROR: IMAGE FILES ONLY';
                    statusEl.style.color = 'var(--alert-red)';
                    return;
                }

                // Show local preview in upload area
                var reader = new FileReader();
                reader.onload = function (e) {
                    var dataUrl = e.target.result;

                    // Preview in upload panel
                    previewImg.src = dataUrl;
                    previewImg.classList.add('visible');
                    placeholder.classList.add('hidden');

                    // Display in SAT-COM LINK
                    satcomImage.src = dataUrl;
                    satcomImage.classList.add('visible');
                    satcomCrosshair.style.display = 'none';
                    satcomContours.style.display = 'none';

                    // Show scanning overlay
                    scanText.textContent = 'SCANNING...';
                    scanningOverlay.classList.add('active');

                    // Trigger simulated YOLO analysis
                    simulateYOLO(file);
                };
                reader.readAsDataURL(file);

                // Upload to server
                statusEl.textContent = 'UPLOADING...';
                statusEl.style.color = 'var(--text-heading)';

                var formData = new FormData();
                formData.append('image', file);

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data.success) {
                            statusEl.textContent = 'UPLOAD CONFIRMED';
                            statusEl.style.color = 'var(--ready-green)';
                        } else {
                            statusEl.textContent = 'ERROR: ' + (data.error || 'UPLOAD FAILED');
                            statusEl.style.color = 'var(--alert-red)';
                        }
                    })
                    .catch(function () {
                        statusEl.textContent = 'TRANSMISSION FAILED';
                        statusEl.style.color = 'var(--alert-red)';
                    });
            }

            // === SIMULATE YOLO DETECTION ===
            function simulateYOLO(image) {
                var aiStatus = document.getElementById('ai-results-status');
                aiStatus.innerHTML = '&gt; PROCESSING IMAGE...<br>&gt; RUNNING YOLO v8 INFERENCE...<br>';

                setTimeout(function () {
                    // Randomly pick a threat type
                    var threats = [
                        { key: 'tank', label: 'TANK', names: ['T-90 MBT', 'M1A2 Abrams', 'Leopard 2A7', 'T-72B3'] },
                        { key: 'jet', label: 'FIGHTER JET', names: ['Su-35 Flanker', 'F-16 Viper', 'MiG-29 Fulcrum', 'J-20 Dragon'] },
                        { key: 'apc', label: 'APC', names: ['BTR-82A', 'M2 Bradley', 'BMP-3', 'LAV-25'] }
                    ];
                    var chosen = threats[Math.floor(Math.random() * threats.length)];
                    var confidence = Math.floor(Math.random() * 34) + 65; // 65–98%
                    var threatName = chosen.names[Math.floor(Math.random() * chosen.names.length)];
                    var sector = Math.floor(Math.random() * 12) + 1;

                    // Update confidence bar
                    var el = confElements[chosen.key];
                    el.fill.style.width = confidence + '%';
                    el.value.textContent = confidence + '%';

                    // Add glow class to the bar
                    el.fill.classList.add('detected');

                    // Add threat feed entry
                    var now = new Date();
                    var timestamp = padZero(now.getHours()) + ':' + padZero(now.getMinutes()) + ':' + padZero(now.getSeconds());
                    var entry = document.createElement('div');
                    entry.className = 'threat-entry alert';
                    entry.textContent = '[' + timestamp + '] THREAT DETECTED: ' + threatName + ' in Sector ' + sector + ' — CONFIDENCE ' + confidence + '%';
                    threatFeed.appendChild(entry);
                    threatFeed.scrollTop = threatFeed.scrollHeight;

                    // Update scanning overlay
                    scanText.textContent = 'ANALYSIS COMPLETE';
                    scanningOverlay.classList.remove('active');
                    scanningOverlay.classList.add('complete');

                    // Update AI analysis status
                    aiStatus.innerHTML =
                        '&gt; DETECTION COMPLETE<br>' +
                        '&gt; TARGET: ' + threatName + '<br>' +
                        '&gt; CLASS: ' + chosen.label + '<br>' +
                        '&gt; CONFIDENCE: ' + confidence + '%<br>' +
                        '&gt; SECTOR: ' + sector + '<br>';

                    // Remove complete state after 3s
                    setTimeout(function () {
                        scanningOverlay.classList.remove('complete');
                    }, 3000);
                }, 1500);
            }

            // === LOAD YOLO RESULT (placeholder for backend integration) ===
            // Call this function with the URL of the processed YOLO image
            // once the backend returns the bounding-box annotated image.
            window.loadYOLOResult = function (imageUrl) {
                yoloResultImage.src = imageUrl;
                yoloResultImage.classList.add('visible');
                tankWireframe.style.display = 'none';
            };

            // === UTILITY ===
            function padZero(n) {
                return n < 10 ? '0' + n : '' + n;
            }
        })();
    </script>
</body>

</html>